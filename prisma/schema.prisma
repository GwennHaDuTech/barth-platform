generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Agent {
  id              String   @id @default(cuid())
  firstname       String
  lastname        String
  email           String   @unique
  phone           String?
  photo           String?
  city            String?
  zipCode         String?
  cityPhoto       String?
  secondarySector String?
  instagram       String?
  linkedin        String?
  tiktok          String?
  bio             String?  @db.Text
  slug            String   @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  listings        Listing[]
  
  // 1. L'agence à laquelle l'agent appartient (Membre)
  agencyId        String?  // Optionnel pour l'instant pour ne pas bloquer les agents existants
  agency          Agency?  @relation("AgencyMembers", fields: [agencyId], references: [id])

  // 2. L'agence que l'agent dirige (Responsable)
  managedAgency   Agency?  @relation("AgencyManager")
}

model Agency {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name      String
  
  // --- NOUVEAUX CHAMPS À AJOUTER ---
  email     String   @unique  // Important: @unique permet de faire findUnique() dessus
  city      String
  zipCode   String
  address   String
  
  phone     String?
  photo     String?   // Peut être String? (optionnel) ou String (obligatoire) selon ton choix

  // Relations existantes (ne pas toucher)
  agents    Agent[]  @relation("AgencyMembers")
  manager   Agent?   @relation("AgencyManager", fields: [managerId], references: [id])
  managerId String?  @unique
}

model Listing {
  id      Int    @id @default(autoincrement())
  title   String
  price   String
  img     String
  agentId String
  agent   Agent  @relation(fields: [agentId], references: [id])
}