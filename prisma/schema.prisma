generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Agent {
  id              String   @id @default(cuid())
  firstname       String
  lastname        String
  email           String   @unique
  phone           String?
  photo           String?
  city            String?
  zipCode         String?
  cityPhoto       String?
  secondarySector String?
  instagram       String?
  linkedin        String?
  tiktok          String?
  bio             String?  @db.Text
  slug            String   @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  listings        Listing[]

  // --- NOUVEAUX CHAMPS ---
  
  // 1. L'agence à laquelle l'agent appartient (Membre)
  agencyId        String?  // Optionnel pour l'instant pour ne pas bloquer les agents existants
  agency          Agency?  @relation("AgencyMembers", fields: [agencyId], references: [id])

  // 2. L'agence que l'agent dirige (Responsable)
  managedAgency   Agency?  @relation("AgencyManager")
}

model Agency {
  id        String   @id @default(cuid())
  name      String   // Correspondra à la "Ville" ou nom de l'agence (ex: "Paris", "Bordeaux")
  photo     String?  // Photo de l'agence en arrière-plan
  phone     String?
  address   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // --- RELATIONS ---

  // Liste des agents rattachés à cette agence
  agents    Agent[]  @relation("AgencyMembers")

  // Le responsable de l'agence (Optionnel)
  managerId String?  @unique
  manager   Agent?   @relation("AgencyManager", fields: [managerId], references: [id])
}

model Listing {
  id      Int    @id @default(autoincrement())
  title   String
  price   String
  img     String
  agentId String
  agent   Agent  @relation(fields: [agentId], references: [id])
}